
var fs = require('fs');

exports.createFile = function(fileName) {
	return CsvStream(fileName);
};

var CsvStream = function(fileName) {
	var csvStream = {};
	
	var stream = fs.createWriteStream(fileName);
	
	var priorFieldExistsOnRow = false;
	
	csvStream.writeRow = function(content) {
		stream.write(content);
		stream.write("\r\n");
		priorFieldExistsOnRow = false;
	};
	
	csvStream.writeField = function(content) {
		if (priorFieldExistsOnRow) {
			stream.write(",");
		}
		
		if (isNaN(content)) {
			content = content.replace("\"", "'");
		}
		stream.write("\""+content+"\"");
		priorFieldExistsOnRow = true;
	};
	
	csvStream.endLine = function() {
		stream.write("\r\n");
		priorFieldExistsOnRow = false;
	};

	return csvStream;
};
